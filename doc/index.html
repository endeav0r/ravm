<html>

<style>
    a:link, a:visited, a:active {
        color: #00009F;
        text-decoration: none;
    }
    a:hover {
        color: #0000FF;
        text-decoration: underline;
    }

    body, div, td {
        font-family: Arial;
        font-size: 12pt;
    }

    h1, h2, h3 { margin: 0px; }
    
    #content {
        width: 780px;
        padding: 8px;
        margin: auto;
        background-color: #EFFFEF;
        border: 1px solid black;
    }
    
    .code {
        background-color: #000000;
        color: #ff9900;
        font-family: Courier New, Monospace;
        font-size: 12pt;
        font-weight: bold;
        padding: 8px;
        display: block;
        margin: auto;
        width: 640px;
    }
        
    
    .instruction_table {
        background-color: #FFEFDF;
        border-right: 1px solid black;
        border-left: 1px solid black;
        text-align: center;
        width: 20%;
    }
</style>

<body>
    <div id="content">
        <h1 align="center">Rainbowsandpwnies<br />Assembler and Virtual Machine</h2>
        
        RAVM is a set of tools designed to help teach assembly level programming to 
        students. It consists of a Virtual Machine implemented in software, with 
        an instruction set that mimics many of the conventions in 32-bit x86 assembly,
        and a corresponding assembler. The virtual machine is referred to
        as the RAVM, and the assembler as the RAVM Assembler (yes, we know that's
        assembler twice).<br/>
        <br/>
        The goals of RAVM are:
        <ul>
            <li>Implement a subset of the x86 instruction set capable of grasping
                by students new to assembly.</li>
            <li>Maintain 32-bit little-endian words.</li>
            <li>Keep the toolchain simple. Students should be learning assembly,
                <em>not features</em>.</li>
            <li>Provide a method for students to monitor the state of the RAVM
                as their assembly programs run.</li>
            <li>Introduce students to basic debugger use such as stepping and
                breakpoints.</li>
        </ul>
        <div style="margin: auto; width:200px; text-align: center;">
            <h1>Contents</h1>
            <div  style="text-align: left">
                <ul>
                    <li><a href="#instruction_set">Instruction Set</a></li>
                    <li><a href="#registers">Registers</a></li>
                    <li><a href="#god_mode">God Mode</a></li>
                    <li><a href="#example_programs">Example Programs</a></li>
                </ul>
            </div>
        </div>
        <a name="instruction_set"></a>
        <h1 align="center">Instruction Set</h2>
        <table width="100%" margin="6" padding="6">
            <tr>
                <td valign="top" class="instruction_table">
                    <h2>Arithmetic</h2>
                    <br />
                    <h3>ADD</h3>
                    <strong>add</strong> rd, rs<br />
                    <strong>add</strong> rd, constant<br />
                    <br/>
                    <h3>SUB</h3>
                    <strong>sub</strong> rd, rs<br />
                    <br/>
                    <h3>MUL</h3>
                    <strong>mul</strong> rd, rs<br />
                    <br/>
                    <h3>DIV</h3>
                    <strong>div</strong> rd, rs<br />
                    <br/>
                    <h3>MOD</h3>
                    <strong>mod</strong> rd, rs<br />
                    <br/>
                    <h3>CMP</h3>
                    <strong>mod</strong> rd, rs<br />
                    <strong>mod</strong> rd, constant<br />
                    <br/>
                </td>
                <td valign="top" class="instruction_table">
                    <h2>Logic</h2>
                    <br />
                    <h3>AND</h3>
                    <strong>and</strong> rd, rs<br />
                    <strong>and</strong> rd, constant<br />
                    <br/>
                    <h3>OR</h3>
                    <strong>and</strong> rd, rs<br />
                    <strong>and</strong> rd, constant<br />
                    <br/>
                    <h3>XOR</h3>
                    <strong>and</strong> rd, rs<br />
                    <strong>and</strong> rd, constant<br />
                    <br/>
                </td>
                <td valign="top" class="instruction_table">
                    <h2>Transfer</h2>
                    <br />
                    <h3>MOV</h3>
                    <strong>mov</strong> rd, rs<br />
                    <strong>mov</strong> rd, constant<br />
                    <strong>mov</strong> [rd], rs<br />
                    <strong>mov</strong> rd, [rs]<br />
                    <br/>
                    <h3>PUSH</h3>
                    <strong>push</strong> rs<br />
                    <br/>
                    <h3>POP</h3>
                    <strong>pop</strong> rd<br />
                    <br/>
                </td>
                <td valign="top" class="instruction_table">
                    <h2>Jumps</h2>
                    <br />
                    <h3>CALL</h3>
                    <strong>call</strong> label<br />
                    <br/>
                    <h3>RET</h3>
                    <strong>ret</strong><br />
                    <br/>
                    <h3>JMP</h3>
                    <strong>jmp</strong> label<br />
                    <br/>
                    <h3>JZ</h3>
                    <strong>jz</strong> label<br />
                    <br/>
                    <h3>JE</h3>
                    <strong>je</strong> label<br />
                    <br/>
                    <h3>JG</h3>
                    <strong>jg</strong> label<br />
                    <br/>
                    
                </td>
                <td valign="top" class="instruction_table">
                    <h2>Other</h2>
                    <br />
                    <h3>NOP</h3>
                    <strong>nop</strong><br />
                </td>
            </tr>
        </table>
        <br />
        
        <a name="registers"></a>
        <h1 align="center">Registers</h2>
        <h3 align="center">r1, r2, r3, r4, r5, r6, r7, rsp, rbp</h3>
        <br />
        
        <a name="god_mode"></a>
        <h1 align="center">God Mode</h2>
        <div style="text-align: center">
            <img src="ravm_god_mode.png" />
        </div>
        <br />
        One interesting feature of the RAVM is God Mode. God Mode allows students
        to observe the entire state of the RAVM during execution of their
        assembled programs. Different areas of the memory are color-coded to
        quickly distinguish what pieces of memory are being used for what
        purposes by the RAVM.<br/>        
        <br />
        RAVM God Mode Legend
        <table>
            <tr>
                <td style="background-color: #06989a; color: #ffffff;">
                    CYAN: .TEXT, or Instructions
                </td>
            </tr><tr>
                <td style="background-color: #4e9a06; color: #ffffff;">
                    GREEN: Next Instruction to Execute
                </td>
            </tr><tr>
                <td style="background-color: #cc0004; color: #ffffff;">
                    RED: Memory pointed to by Stack Pointer
                </td>
            </tr><tr>
                <td style="background-color: #75507b; color: #ffffff;">
                    MAGENTA: Memory pointed to be Base Pointer
                </td>
            </tr><tr>
                <td style="background-color: #3465a4; color: #ffffff;">
                    BLUE: Call Stack
                </td>
            </tr><tr>
                <td style="background-color: #c4a000; color: #ffffff;">
                    YELLOW: User Cursor
                </td>
            </tr>
        </table>
        <br />
        
        <a name="example_programs"></a>
        <h1 align="center">Example Assembly Programs</h1>
        <h2 align="center">Prime Finder</h2>
        <pre class="code">
main :
    mov rbp, rsp
    add rsp, -40
    mov r1, 2

main_loop :
    push r1
    call check_for_prime
    add RSP, 4
    
    mov r2, rbp
    mov r3, r1
    mov r4, 4
    mul r3, r4
    sub r2, r3
    mov [r2], r0
    
    add r1, 1
    cmp r1, 10
    je main_hlt
    jmp main_loop


main_hlt :
    hlt

check_for_prime :
    push rbp
    mov rbp, rsp
    
    push r1
    push r2
    
    mov r0, rbp
    add r0, 8
    mov r0, [r0]
    
    mov r1, 2 ; r1 is the number we check against r0
    
check_for_prime_loop :
    mov r2, r1
    mul r2, r2
    cmp r2, r0
    jg check_for_prime_return_true
    
    mov r2, r0
    mod r2, r1
    cmp r2, 0
    jz check_for_prime_return_false
    
    add r1, 1
    jmp check_for_prime_loop
    
check_for_prime_return_false :
    mov r0, -1
    jmp check_for_prime_return

check_for_prime_return_true :
    mov r0, 1
    jmp check_for_prime_return
    
check_for_prime_return :
    pop r2
    pop r1
    pop rbp
    ret</pre>
    </div>
</body>
</html>
